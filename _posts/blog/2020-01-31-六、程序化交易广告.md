---
layout: post
title: 计算广告 六、程序化交易广告
categories: [计算广告]
description: 程序化交易广告
keywords: 计算广告, 程序化交易广告
---

随着需求方优化效果的要求进一步加强，除了允许广告主按照已经定义好的用户划分来购买，还要进一步提供广告主自行选择流量和在每次展示上独立出价的功能。这就要求询价、出价和竞价在展示时进行，也就产生了以**实时竞价（Real Time Biding，RTB）** 为核心的程序化交易市场。

由此，产生了**广告交易平台（ADX）**。ADX的主要特征是用RTB的方式实时得到广告候选，并按照其出价简单完成投放决策。与ADX对应的采买方称为**需求方平台（DSP）**。出价需求的存在和广告主预算范围内的套利要求DSP具备以下能力：
* 点击率预测。
* 点击价值估计。
* 流量预测。
* 站外推荐。

在需求发给利益得到保证后，媒体的变现手段至少有了四种选择：
* 担保式投送的合约售卖方式
* 自营广告网络
* 托管给其他广告网络
* 通过RTB变现

如何动态选择这四种，产生了**供给方平台（Supply Side Platform，SSP）**。

RTB的发展还催生了数据加工和交易的两个关键产品：**数据交易平台（Data Exchange）**和**数据管理平台（Data Management Platform，DMP）**。

# 1 实时竞价
竞价广告网络中的受众定向虽然很精准，但是仍然有一些无法完成的场景，比如：
* 广告主希望对自己流失的用户进行一次广告促销。
* 广告主希望广告平台帮助找到与其用户类似的潜在用户。

这两种情景都有一个共同的特点，那就是我们在加工人群标签的过程中需要利用到广告主的数据。这样的标签称为**定制化用户标签（customized audience segmentation）**。

采用广告网络这样的封闭式竞价方案无法规模化和精细化的针对定制化标签进行投放。**用定制化标签指导广告投放是实时竞价的关键产品目标**。

## 1.1 实时竞价流程
![实时竞价过程](http://qixingjun.tech/images/%E8%AE%A1%E7%AE%97%E5%B9%BF%E5%91%8A/6.1%E5%AE%9E%E6%97%B6%E7%AB%9E%E4%BB%B7%EF%BC%88RTB%EF%BC%89%E8%BF%87%E7%A8%8B%E7%A4%BA%E6%84%8F.png)
实时竞价的接口可以分为两个过程：
* 预先进行的将ADX与DSP的用户标识对应起来的**cookie映射（cookie mapping）过程**。当供给方和需求方得到的用户标识不同，特别是在web环境下根据cookie投放广告时，需要一个预先的映射过程。映射一般是由DSP在广告主网站上发起，因为DSP负责的是加工广告主定制受众标签，因而不需要对所有用户建立对应关系。映射过程可以细分成两个步骤：

    * 1.1 从广告主网站向DSP服务器发起cookie请求。
    * 1.2 DSP与ADX服务器之间通信完成cookie映射。
    
* 线上**广告请求（ad call）**时的竞价和投放过程。RTB的广告请求可以细分为四个步骤：

    * 2.1 用户浏览媒体网站。
    * 2.2 媒体通过js或者SDK向ADX发起广告请求。
    * 2.3 ADX向各个DSP传送URL（==什么URL？==）和本域名cookie，发起询价请求。DSP如果决定参与竞价，则返回自己的出价。ADX等待固定时间后，选择出价最高的DSP返回给媒体网站。
    * 2.4 媒体网站从胜出的DSP拿到广告创意并展示。
    
# 2 其他程序化交易方式
在实时竞价产生以后，广告交易越来越多的依赖机器间在线的协作而非事先约定或者人工操作完成，这样的交易方式称为**程序化交易**。程序化交易的核心目的是**让需求方能够自由的选择流量和出价**。除了RTB之外，其他的程序化交易方式还有**优选**和**私有市场**。

## 2.1 优选
优选可以看成是只有一个需求方的程序化交易。它允许单个需求方按照自己的意愿挑选流量，但是又可以避免复杂的竞价过程。

## 2.2 私有市场
媒体为了保证广告主的质量，希望将拍卖限制在一些被邀请的需求方范围内。交易过程和公开的实时竞价一致。这种程序化交易叫做私有市场。

# 3 广告交易平台
广告交易平台即ADX，负责将媒体流量以拍卖的方式售卖给DSP。ADX中需要注意的产品策略，主要是如何解决给多个DSP广告请求带来的带宽和机器成本的上升。这一问题称为**询价优化（call out optimization）**。ADX的一般结算方式为CPM结算。

# 4 需求方平台
与ADX相对应，以RTB方式购买广告的产品形态是需求方平台，即DSP。DSP的核心特征有两个：
* 以RTB方式的流量购买。
* 需要支持需求方定制化的用户划分。

## 4.1 产品策略
![DSP的广告决策过程示意](http://qixingjun.tech/images/%E8%AE%A1%E7%AE%97%E5%B9%BF%E5%91%8A/6.4.1DSP%E5%B9%BF%E5%91%8A%E5%86%B3%E7%AD%96%E8%BF%87%E7%A8%8B%E7%A4%BA%E6%84%8F.png)
如图所示，DSP的广告决策过程和广告网络的广告决策过程很相似，差别就在于DSP广告完成广告定价后，又增加了出价的步骤。在各种定制化标签中，DSP需要特别重视的有**重定向**和**look-alike（新客推荐）**。

## 4.2 出价策略
在ADN中，估计eCPM是为了对广告排序，不需要绝对的eCPM值。但是在DSP中，每次展示都要按CPM向ADX报价，因此准确的估计eCPM的值很重要。这也是DSP出价策略的基础。

DSP的出价策略可以定性的描述为：
1. 通过历史观察和预测得到市价的曲线。
2. 将一天的流量分配到市价较低的流量上。

当然，我们更希望获得的是eCPM与市价的比例较大的流量。所以，DSP的出价策略要基于两条曲线，即eCPM和市价随时间变化的曲线。

## 4.3 重定向
重定向是指把哪些曾经对广告主服务有明确兴趣的用户找出来，向他们投放该广告主的广告。重定向又可以根据信息来源和使用信息的精细程度分为：**网站重定向、个性重定向、搜索重定向**。

### 4.3.1 网站重定向（site reatargeting）
网站重定向，即将在一段时间内到达过广告主网站的用户作为重定向集合。采买这种重定向流量时，能够得到的量有两个影响因素：
* 广告主网站本身的独立访客量水平
* 访客与媒体的重合程度

### 4.3.2 个性化重定向（personalized retargeting）
个性化重定向是网站重定向的一种特例。对定向流量进行深入的加工，按照品类和购买阶段等因素进行创意上的深度个性化，就是个性化重定向。也可以称为**站外推荐（off-site recommendation）**。个性化重定向与传统的受众定向方式的差别：
* **动态创意**。动态创意是个性化重定向的最重要技术，也是在线广告朝着个性化、动态化发展的重要一步。
* **推荐引擎**。站外推荐是根据用户信息来进行。
* **广告主商品库存实时接口**。避免用户通过站外推荐点击到达广告主网站时，发现商品已售罄或者已下架，影响用户体验和广告主口碑。

### 4.3.3 搜索重定向（search retargeting）
将搜索过与广告主直接相关的关键词的用户群作为重定向集合。如何获得搜索重定向中用的词表呢？推荐使用基于广告主流量统计的方法。即统计广告主网站流量中搜索引擎来的流量，将其中频次较高的关键词作为搜索重定向词表。

## 4.4 新客推荐
由广告主根据自己的第一方数据提供一部分种子用户，再由拥有更丰富数据的第二方数据的广告平台分析这些用户网络行为的特征，并根据这些特征找到具有相似特征的拓展人群。这样的标签加工策略称为**新客推荐（look-alike）**。

# 5 供给方平台
广告请求时被分配到自运营广告库还是其他广告网络，或者是DSP，是根据他们的收益在线动态决定的，这样的方案称为**动态分配（dynamic allocation）**。对应的产品形态就是**供给方平台（Supply Side Platform，SSP）**。

## 5.1 产品策略
![动态分配决策过程示意](http://qixingjun.tech/images/%E8%AE%A1%E7%AE%97%E5%B9%BF%E5%91%8A/6.5.1%20%E5%8A%A8%E6%80%81%E5%88%86%E9%85%8D%E5%86%B3%E7%AD%96%E8%BF%87%E7%A8%8B%E7%A4%BA%E6%84%8F%E5%9B%BE.png)
如图所示是SSP中多种广告源动态分配的决策过程。具体分为5步骤：
1. 从自有广告库中根据当前受众标签检索合适的广告候选，并估计每个广告候选的eCPM。
2. 排序得到eCPM最高的广告候选以及相应的eCPM值r1<sub>Max</sub>。
3. 同样根据环境信息和受众标签估算出各个合作ADN的大致eCPM。
4. 排序得到eCPM最高的广告候选以及相应的eCPM值r2<sub>Max</sub>。
5. 以max（r1<sub>Max</sub>,r2<sub>Max</sub>）为底价，通过RTB接口向各个合作的DSP查询更高变现价值的广告。

# 6 数据加工与交易
巧妇难为无米之炊，“数据”的来源和质量是很重要的。

## 6.1 有价值的数据来源
* **用户标识**。无论拿到多少数据，如果无法把他们与投放系统联系起来，这些数据都无法发挥作用。所以确定哪些行为来自于同一个用户是非重要的。对于浏览器行为，最常用的用户标识是**cookie**。IOS的用户Id是**广告专用用户标识符（Identifier for Ad，IDFA）**，其与cookie类似。安卓的用户Id一般采用**Android Id**或者**IMEI（international mobile equipment identity）**。
* **用户行为**。按照对效果广告的有效性分类，用户行为可以分为**决策行为、主动行为、半主动行为和被动行为**。
    1. 决策行为主要包括**转化（conversion）**和**预转化（pre-conversion）**。
    2. 主动行为主要包括**广告点击**、**搜索**、**搜索点击**。
    3. 半主动行为主要包括**分享**和**网页浏览**。
    4. 被动行为主要是指**广告浏览**。
* **人口属性**。
* **地理位置**。
* **社交关系**。

随着用户主动意图的提升，相应的行为数据信息价值也随之增大；越是接近转化的行为，对效果广告的精准指导作用越强。

## 6.2 三方数据划分
广告中用到的数据，根据其来源的不同可以分为第一方数据、第二方数据和第三方数据。
第一方是指广告主，第二方是指广告平台，第三方是指不直接参与广告交易的其他数据提供方。在ADN中，主要使用第二方数据。在RTB下，三方的数据都用得到。

## 6.3 数据管理平台
**数据管理平台（Data Management Platform，DMP）**是对第一方数据进行收集和加工的。DMP负责广告主网站的用户积累和划分，并通过数据接口的方式传送给广告平台。

## 6.4 数据交易平台
**数据交易平台（Data Exchange）**的主要产品功能是聚合各种来源的在线的用户行为数据，加工成有价值的用户标签，然后在广告市场上通过售卖这些标签来变现。主要是站在第三方数据的角度提供产品。

# 7 在线广告产品交互关系
![在线广告产品交互关系](http://qixingjun.tech/images/%E8%AE%A1%E7%AE%97%E5%B9%BF%E5%91%8A/6.7%E5%9C%A8%E7%BA%BF%E5%B9%BF%E5%91%8A%E5%B8%82%E5%9C%BA%E4%BA%A7%E5%93%81%E4%BA%A4%E4%BA%92%E5%85%B3%E7%B3%BB.png)
如图所示，是在线广告产品的交互关系。

从媒体角度来看，有三种产品可以帮助其变现流量：
1. 可以加个广告位托管给ADN，由ADN决策广告投放。如图中的媒体1。
2. 可以将广告位对接到ADX，以RTB的方式变现。如图中的媒体2。
3. 可以将广告位托管给SSP，这样可以对接多个ADN和PMP接口，并按照动态分配的逻辑选择变现最高的需求方。如图中媒体3。

从需求端来看，无论是广告主还是代理公司，主要通过两类产品来采买流量：
1. 面向实时竞价的DSP产品。（适合采买定制化人群，并进行深入的流量优化）
2. 面向非实时竞价的TD产品。（适合简单、低成本的通用人群购买）

ADX比较中立，才需求方和供给方之间提供公开、公平的流量交换能力。ADX的流量可以来自媒体、ADN或者SSP。

SSP代表的是媒体的利益，将ADN、ADX和DSP都视为提供预算的需求方。

从ADN的角度看，有以下两种需求方对接方式：
1. 与TD对接，通过TD将流量售卖给广告主。
2. 将流量导入ADX，以RTB的方式变现。
